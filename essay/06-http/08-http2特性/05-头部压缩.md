# 头部压缩 

HTTP 1.1请求头大小变得越来越大，有时甚至会大于TCP窗口的初始大小，因为它们需要等待带着ACK的响应回来以后才能继续被发送。
HTTP/2对消息头采用HPACK（专为http/2头部设计的压缩格式）进行压缩传输，能够节省消息头占用的网络的流量。
而HTTP/1.x每次请求，都会携带大量冗余头信息，浪费了很多带宽资源。

HTTP每一次通信都会携带一组头部，用于描述这次通信的的资源、浏览器属性、cookie等，例如05-HTTP每一次通信都会携带一组头部.png

为了减少这块的资源消耗并提升性能， HTTP/2对这些首部采取了压缩策略：
1. HTTP/2在客户端和服务器端使用“首部表”来跟踪和存储之前发送的键－值对，对于相同的数据，不再通过每次请求和响应发送；
2. 首部表在HTTP/2的连接存续期内始终存在，由客户端和服务器共同渐进地更新;
3. 每个新的首部键－值对要么被追加到当前表的末尾，要么替换表中之前的值。
例如：下图中的两个请求， 请求一发送了所有的头部字段，第二个请求则只需要发送差异数据，这样可以减少冗余数据，降低开销。05-http2首部表.jpg

我们来看一个实际的例子，下面是用WireShark抓取的访问google首页的包：

1. 05-WireShark抓取的访问google首页的包.jpg 是是访问https://www.google.com/抓到的第一个请求的头部，可以看到头部的内容，总共占用了437 bytes，我们选中头部的cookie，可以看到cookie总共占用了118 bytes

2. 接下来我们看看第二个请求的头部：05-接下来我们看看第二个请求的头部.jpg，从图可以看到，得益于头部压缩，第二个请求中cookie只占用了1个字节，

3. 我们来看看变化了的Accept字段：05-变化了的Accept字段.jpg，由于Accept字段与请求一中的内容不同，需要发送给服务器，所以占用了29 bytes。